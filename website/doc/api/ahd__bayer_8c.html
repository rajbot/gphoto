<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.5"/>
<title>libgphoto2 photo camera library (libgphoto2) API: libgphoto2/ahd_bayer.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">libgphoto2 photo camera library (libgphoto2) API
   &#160;<span id="projectnumber">2.5.4.1</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.5 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('ahd__bayer_8c.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">ahd_bayer.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Adaptive Homogeneity-Directed Bayer array conversion routine.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;stdio.h&gt;</code><br/>
<code>#include &lt;stdlib.h&gt;</code><br/>
<code>#include &lt;string.h&gt;</code><br/>
<code>#include &lt;math.h&gt;</code><br/>
<code>#include &lt;time.h&gt;</code><br/>
<code>#include &quot;config.h&quot;</code><br/>
<code>#include &quot;<a class="el" href="bayer_8h_source.html">bayer.h</a>&quot;</code><br/>
<code>#include &lt;<a class="el" href="gphoto2-result_8h_source.html">gphoto2/gphoto2-result.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="gphoto2-port-log_8h_source.html">gphoto2/gphoto2-port-log.h</a>&gt;</code><br/>
</div><div class="textblock"><div class="dynheader">
Include dependency graph for ahd_bayer.c:</div>
<div class="dyncontent">
<div class="center"><img src="ahd__bayer_8c__incl.png" border="0" usemap="#libgphoto2_2ahd__bayer_8c" alt=""/></div>
<map name="libgphoto2_2ahd__bayer_8c" id="libgphoto2_2ahd__bayer_8c">
<area shape="rect" id="node15" href="bayer_8h.html" title="bayer.h" alt="" coords="531,88,596,115"/><area shape="rect" id="node17" href="gphoto2-result_8h.html" title="gphoto2/gphoto2&#45;result.h" alt="" coords="620,88,784,115"/><area shape="rect" id="node21" href="gphoto2-port-log_8h.html" title="gphoto2/gphoto2&#45;port\l&#45;log.h" alt="" coords="809,81,953,122"/><area shape="rect" id="node19" href="gphoto2-port-result_8h.html" title="gphoto2/gphoto2&#45;port\l&#45;result.h" alt="" coords="631,171,775,213"/></map>
</div>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a42d5a3f91ac1e8add4295c0d288c182f"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a42d5a3f91ac1e8add4295c0d288c182f"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>GP_MODULE</b>&#160;&#160;&#160;&quot;ahd_bayer&quot;</td></tr>
<tr class="separator:a42d5a3f91ac1e8add4295c0d288c182f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aacc3ee1a7f283f8ef65cea31f4436a95"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="aacc3ee1a7f283f8ef65cea31f4436a95"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>MAX</b>(x, y)&#160;&#160;&#160;((x &lt; y) ? (y) : (x))</td></tr>
<tr class="separator:aacc3ee1a7f283f8ef65cea31f4436a95"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a74e75242132eaabbc1c512488a135926"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a74e75242132eaabbc1c512488a135926"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>MIN</b>(x, y)&#160;&#160;&#160;((x &gt; y) ? (y) : (x))</td></tr>
<tr class="separator:a74e75242132eaabbc1c512488a135926"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaefe6f014fd5125ca10cc315080003c7"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="aaefe6f014fd5125ca10cc315080003c7"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>CLAMP</b>(x)&#160;&#160;&#160;MAX(MIN(x,0xff),0)</td></tr>
<tr class="separator:aaefe6f014fd5125ca10cc315080003c7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8d23feea868a983c8c2b661e1e16972f"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a8d23feea868a983c8c2b661e1e16972f"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>RED</b>&#160;&#160;&#160;0</td></tr>
<tr class="separator:a8d23feea868a983c8c2b661e1e16972f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acfbc006ea433ad708fdee3e82996e721"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="acfbc006ea433ad708fdee3e82996e721"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>GREEN</b>&#160;&#160;&#160;1</td></tr>
<tr class="separator:acfbc006ea433ad708fdee3e82996e721"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a79d10e672abb49ad63eeaa8aaef57c38"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a79d10e672abb49ad63eeaa8aaef57c38"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>BLUE</b>&#160;&#160;&#160;2</td></tr>
<tr class="separator:a79d10e672abb49ad63eeaa8aaef57c38"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7e98848076c6c8edd529cd3b04beae8d"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a7e98848076c6c8edd529cd3b04beae8d"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>AD</b>(x, y, w)&#160;&#160;&#160;((y)*(w)*3+3*(x))</td></tr>
<tr class="separator:a7e98848076c6c8edd529cd3b04beae8d"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ad3e98332c40eea761faae753444cfcad"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ahd__bayer_8c.html#ad3e98332c40eea761faae753444cfcad">gp_ahd_interpolate</a> (unsigned char *image, int w, int h, <a class="el" href="bayer_8h.html#a73f27c759ee5f212bd21199e45d5b38c">BayerTile</a> tile)</td></tr>
<tr class="memdesc:ad3e98332c40eea761faae753444cfcad"><td class="mdescLeft">&#160;</td><td class="mdescRight">Interpolate a expanded bayer array into an RGB image.  <a href="#ad3e98332c40eea761faae753444cfcad">More...</a><br/></td></tr>
<tr class="separator:ad3e98332c40eea761faae753444cfcad"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0a10c31feb99742199ca9b8479809ee4"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ahd__bayer_8c.html#a0a10c31feb99742199ca9b8479809ee4">gp_ahd_decode</a> (unsigned char *input, int w, int h, unsigned char *output, <a class="el" href="bayer_8h.html#a73f27c759ee5f212bd21199e45d5b38c">BayerTile</a> tile)</td></tr>
<tr class="memdesc:a0a10c31feb99742199ca9b8479809ee4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Convert a bayer raster style image to a RGB raster.  <a href="#a0a10c31feb99742199ca9b8479809ee4">More...</a><br/></td></tr>
<tr class="separator:a0a10c31feb99742199ca9b8479809ee4"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Adaptive Homogeneity-Directed Bayer array conversion routine. </p>
<dl class="section author"><dt>Author</dt><dd>Copyright March 12, 2008 Theodore Kilgore <a href="#" onclick="location.href='mai'+'lto:'+'kil'+'go'+'ta@'+'au'+'bur'+'n.'+'edu'; return false;">kilgo<span style="display: none;">.nosp@m.</span>ta@a<span style="display: none;">.nosp@m.</span>uburn<span style="display: none;">.nosp@m.</span>.edu</a></dd></dl>
<dl class="section user"><dt></dt><dd><a class="el" href="ahd__bayer_8c.html#ad3e98332c40eea761faae753444cfcad" title="Interpolate a expanded bayer array into an RGB image. ">gp_ahd_interpolate()</a> from Eero Salminen <a href="#" onclick="location.href='mai'+'lto:'+'esa'+'lm'+'ine'+'@g'+'mai'+'l.'+'com'; return false;">esalm<span style="display: none;">.nosp@m.</span>ine@<span style="display: none;">.nosp@m.</span>gmail<span style="display: none;">.nosp@m.</span>.com</a> and Theodore Kilgore. The work of Eero Salminen is for partial completion of a Diploma in Information and Computer Science, Helsinki University of Technology, Finland.</dd></dl>
<dl class="section user"><dt></dt><dd>The algorithm is based upon the paper</dd></dl>
<dl class="section user"><dt></dt><dd>Adaptive Homogeneity-Directed Democsaicing Algoritm, Keigo Hirakawa and Thomas W. Parks, presented in the IEEE Transactions on Image Processing, vol. 14, no. 3, March 2005.</dd></dl>
<dl class="section user"><dt>License</dt><dd>This library is free software; you can redistribute it and/or modify it under the terms of the GNU Lesser General Public License as published by the Free Software Foundation; either version 2 of the License, or (at your option) any later version.</dd></dl>
<dl class="section user"><dt></dt><dd>This library is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Lesser General Public License for more details.</dd></dl>
<dl class="section user"><dt></dt><dd>You should have received a copy of the GNU Lesser General Public License along with this library; if not, write to the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA </dd></dl>
</div><h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="a0a10c31feb99742199ca9b8479809ee4"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int gp_ahd_decode </td>
          <td>(</td>
          <td class="paramtype">unsigned char *&#160;</td>
          <td class="paramname"><em>input</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>w</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>h</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned char *&#160;</td>
          <td class="paramname"><em>output</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="bayer_8h.html#a73f27c759ee5f212bd21199e45d5b38c">BayerTile</a>&#160;</td>
          <td class="paramname"><em>tile</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Convert a bayer raster style image to a RGB raster. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">input</td><td>the bayer CCD array as linear input </td></tr>
    <tr><td class="paramname">w</td><td>width of the above array </td></tr>
    <tr><td class="paramname">h</td><td>height of the above array </td></tr>
    <tr><td class="paramname">output</td><td>RGB output array (linear, 3 bytes of R,G,B for every pixel) </td></tr>
    <tr><td class="paramname">tile</td><td>how the 2x2 bayer array is layed out</td></tr>
  </table>
  </dd>
</dl>
<p>A regular CCD uses a raster of 2 green, 1 blue and 1 red components to cover a 2x2 pixel area. The camera or the driver then interpolates a 2x2 RGB pixel set out of this data.</p>
<p>This function expands and interpolates the bayer array to 3 times larger bitmap with RGB values interpolated. It does the same job as <a class="el" href="bayer_8c.html#aed7e2fecaf82319d58da714a4c00932c" title="Convert a bayer raster style image to a RGB raster. ">gp_bayer_decode()</a> but it calls <a class="el" href="ahd__bayer_8c.html#ad3e98332c40eea761faae753444cfcad" title="Interpolate a expanded bayer array into an RGB image. ">gp_ahd_interpolate()</a> instead of calling <a class="el" href="bayer_8c.html#a38afd801f9ae2b9ebcf1924e90b9a28e" title="Interpolate a expanded bayer array into an RGB image. ">gp_bayer_interpolate()</a>. Use this instead of <a class="el" href="bayer_8c.html#aed7e2fecaf82319d58da714a4c00932c" title="Convert a bayer raster style image to a RGB raster. ">gp_bayer_decode()</a> if you want to use or to test AHD interpolation in a camera library. </p>
<dl class="section return"><dt>Returns</dt><dd>a gphoto error code </dd></dl>

<p>References <a class="el" href="ahd__bayer_8c.html#ad3e98332c40eea761faae753444cfcad">gp_ahd_interpolate()</a>, <a class="el" href="bayer_8c.html#aea1cec99470e5722fff043ecf5167acd">gp_bayer_expand()</a>, and <a class="el" href="gphoto2-port-result_8h.html#a560d29bd042a83bdd6a87a5f3ffbcff4">GP_OK</a>.</p>

</div>
</div>
<a class="anchor" id="ad3e98332c40eea761faae753444cfcad"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int gp_ahd_interpolate </td>
          <td>(</td>
          <td class="paramtype">unsigned char *&#160;</td>
          <td class="paramname"><em>image</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>w</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>h</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="bayer_8h.html#a73f27c759ee5f212bd21199e45d5b38c">BayerTile</a>&#160;</td>
          <td class="paramname"><em>tile</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Interpolate a expanded bayer array into an RGB image. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">image</td><td>the linear RGB array as both input and output </td></tr>
    <tr><td class="paramname">w</td><td>width of the above array </td></tr>
    <tr><td class="paramname">h</td><td>height of the above array </td></tr>
    <tr><td class="paramname">tile</td><td>how the 2x2 bayer array is layed out</td></tr>
  </table>
  </dd>
</dl>
<p>This function interpolates a bayer array which has been pre-expanded by <a class="el" href="bayer_8c.html#aea1cec99470e5722fff043ecf5167acd" title="Expand a bayer raster style image to a RGB raster. ">gp_bayer_expand()</a> to an RGB image. It applies the method of adaptive homogeneity-directed demosaicing.</p>
<dl class="section return"><dt>Returns</dt><dd>a gphoto error code</dd></dl>
<dl class="section user"><dt></dt><dd>In outline, the interpolation algorithm used here does the following:</dd></dl>
<dl class="section user"><dt></dt><dd>In principle, the first thing which is done is to split off from the image two copies. In one of these, interpolation will be done in the vertical direction only, and in the other copy only in the horizontal direction. "Cross-color" data is used throughout, on the principle that it can be used as a corrector for brightness even if it is derived from the "wrong" color. Finally, at each pixel there is a choice criterion to decide whether to use the result of the vertical interpolation, the horizontal interpolation, or an average of the two.</dd></dl>
<dl class="section user"><dt></dt><dd>Memory use and speed are optimized by using two sliding windows, one for the vertical interpolation and the other for the horizontal interpolation instead of using two copies of the entire input image. The nterpolation and the choice algorithm are then implemented entirely within these windows, too. When this has been done, a completed row is written back to the image. Then the windows are moved, and the process repeats. </dd></dl>

<p>References <a class="el" href="bayer_8h.html#a73f27c759ee5f212bd21199e45d5b38caac685ba6e519a7e73422b1bb7e86cfab">BAYER_TILE_BGGR</a>, <a class="el" href="bayer_8h.html#a73f27c759ee5f212bd21199e45d5b38ca882acd4566c995e287c8bdf251b44aed">BAYER_TILE_BGGR_INTERLACED</a>, <a class="el" href="bayer_8h.html#a73f27c759ee5f212bd21199e45d5b38ca38df64665d45fcae637353fe6a6ec650">BAYER_TILE_GBRG</a>, <a class="el" href="bayer_8h.html#a73f27c759ee5f212bd21199e45d5b38ca02888640f370fc70595d098339db24ab">BAYER_TILE_GBRG_INTERLACED</a>, <a class="el" href="bayer_8h.html#a73f27c759ee5f212bd21199e45d5b38cac82e3fd69f3cde6ecff5ba79d973221a">BAYER_TILE_GRBG</a>, <a class="el" href="bayer_8h.html#a73f27c759ee5f212bd21199e45d5b38cae46f712233f8c856dc7b88449fbee7dc">BAYER_TILE_GRBG_INTERLACED</a>, <a class="el" href="bayer_8h.html#a73f27c759ee5f212bd21199e45d5b38cabe44a26af096795acaabf967450d2f81">BAYER_TILE_RGGB</a>, <a class="el" href="bayer_8h.html#a73f27c759ee5f212bd21199e45d5b38ca750a6d3eedc2bffe234f54b16ed3fd6f">BAYER_TILE_RGGB_INTERLACED</a>, <a class="el" href="gphoto2-port-result_8h.html#a3d7d0cbb390f931e72a3b67c999a9183">GP_ERROR_NO_MEMORY</a>, and <a class="el" href="gphoto2-port-result_8h.html#a560d29bd042a83bdd6a87a5f3ffbcff4">GP_OK</a>.</p>

<p>Referenced by <a class="el" href="bayer_8h.html#a0a10c31feb99742199ca9b8479809ee4">gp_ahd_decode()</a>.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_df723b3f25cfe80b0e773fc78a5873a4.html">libgphoto2</a></li><li class="navelem"><a class="el" href="ahd__bayer_8c.html">ahd_bayer.c</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.5 </li>
  </ul>
</div>
</body>
</html>
